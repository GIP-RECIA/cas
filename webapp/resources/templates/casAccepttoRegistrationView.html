<!DOCTYPE html>
<html xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{layout}">

<head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/>

    <title>Acceptto Registration View</title>
    <link href="../../static/css/cas.css" rel="stylesheet" th:remove="tag"/>

    <script type="text/javascript" src="https://faye.acceptto.com/faye/faye.js"></script>
    <script type="text/javascript" src="https://dbfp.acceptto.com/bfp.js"></script>
</head>

<body>
<main role="main" class="container mt-3 mb-3">
    <div layout:fragment="content" id="login">
        <div>
            <h3>Register Device</h3>

            <ol>
                <li>Open the app store and search for "Acceptto It's Me".</li>
                <li>Install the "Acceptto It's Me" application.</li>
                <li>Open the application and follow the instructions to access the QR Code scanner.</li>
                <li>Scan this QR Code.</li>
            </ol>

            <div>
                <a href="https://itunes.apple.com/us/app/acceptto-itsme/id893534370?mt=8" target="_blank">
                    <img src="https://s3-us-west-2.amazonaws.com/acceptto-log-and-graphics/Asset+14.png" alt="App Store" title="App Store" width="151.25" height="50">
                </a>
                <a href="https://play.google.com/store/apps/details?id=com.acceptto.mfa&amp;amp;hl=en" target="_blank">
                    <img src="https://s3-us-west-2.amazonaws.com/acceptto-log-and-graphics/Asset+13.png" alt="Google Play" title="Google Play" width="151.25" height="50">
                </a>
            </div>


            <form method="POST" id="fmAccepttoQRCode">

                <script type="text/javascript" th:inline="javascript">
                    /*<![CDATA[*/
                    $(function () {
                        var uid = /*[[${accepttoApplicationId}]]*/;
                        var invitationToken = /*[[${accepttoInvitationToken}]]*/;

                        var qrcodeJSON = '{ "app_uid":"' + uid + '", "channel":"' + invitationToken + '" }';
                        var qrcode = window.btoa(qrcodeJSON);
                        var src = "https://chart.apis.google.com/chart?cht=qr&chs=220x220&chl=" + qrcode + "#&chld=H|0";
                        $('#login_qrcode').attr("src", src);

                        var faye = new Faye.Client("https://faye.acceptto.com/faye");
                        faye.subscribe("/messages/" + invitationToken,
                            function (data) {
                                $('#fmAccepttoQRCode').submit();
                            }
                        );
                    });
                    /*]]>*/
                </script>

                <input type="hidden" name="_eventId" value="success"/>
                <input type="hidden" name="execution" th:value="${flowExecutionKey}"/>
            </form>
            <center>
                <img id="login_qrcode" alt="QR Code">
            </center>
        </div>
    </div>
</main>
</body>
</html>
